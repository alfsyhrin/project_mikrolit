<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Dosen</title>

    <!-- Link ke CSS Halaman ini (dashboard.css) -->
    <link rel="stylesheet" href="../assets/css/dashboard.css">

    <!-- Link ke CSS global -->
    <link rel="stylesheet" href="../assets/css/main.css">

    <!-- Link untuk mengakses icon material symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">

    <!-- Link untuk mengakses font google -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Link untuk mengakses font 'ASAP' dari google -->
    <link href="https://fonts.googleapis.com/css2?family=Asap:ital,wght@0,100..900;1,100..900&family=Sarina&display=swap" rel="stylesheet">
</head>
<body>

    <div class="container">
        <div class="sidebar" id="sidebar">
            <div class="judul-aplikasi">
                <p class="logo"><span class="material-symbols-outlined">school</span></p>
                <div class="nama-logo text">
                    <h1>MikroLit LMS</h1>
                    <p>Panel Dosen</p>
                </div>
            </div>

            <div class="sidebar-wrapper">

                <div class="sidebar-list">
                    <ul type="none">
                        <li>
                            <a href="#" data-page="beranda"><p><span class="material-symbols-outlined icon">dashboard</span></p><span class="text">Beranda</span></a>
                        </li>
                        <li>
                            <a href="#" data-page="manajemen-pengguna"><p><span class="material-symbols-outlined icon">group</span></p><span class="text">Manajemen Pengguna</span></a>
                        </li>
                        <li>
                            <a href="#" data-page="monitoring"><p><span class="material-symbols-outlined icon">monitoring</span></p><span class="text">Monitoring</span></a>
                        </li>
                        <li>
                            <a href="#" data-page="micro-learning"><p><span class="material-symbols-outlined icon">auto_stories</span></p><span class="text">Micro-Learning</span></a>
                        </li>
                        <li>
                            <a href="#" data-page="pengaturan"><p><span class="material-symbols-outlined icon">settings</span></p><span class="text">Pengaturan</span></a>
                        </li>
                    </ul>
                </div>
                <div class="sidebar-tool">
                    <ul type="none">
                        <li>
                            <button id="collapseBtn"><p><span class="material-symbols-outlined">chevron_left</span></p>Collapse</button>
                        </li>
                        <li>
                            <a href="#" id="btn-logout" class="logout-sidebar"><p><span class="material-symbols-outlined icon">logout</span></p><span class="text">Logout</span></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="overlay" id="overlay"></div>

        <main>
            <div class="navbar">
                <div class="navbar-kiri">
                     <button id="mobile-toggle" ><span class="material-symbols-outlined">menu</span></button>
                    <h2>Beranda</h2>
                </div>
                <div class="navbar-kanan">
                    <p class="foto-profil"><span class="material-symbols-outlined">person</span></p>
                    <div class="info-user">
                        <h3 id="showName"></h3>
                        <p id="showNidn"></p>
                    </div>
                </div>
            </div>
            <div class="content">
                
            </div>
        </main>
    </div>

    <!-- Link untuk mengakses Apex chart lokal -->
    <script src="../assets/js/apexcharts.min.js"></script>

    <!-- Link untuk mengakses kodingan Apex chart lokal -->
    <script src="../assets/js/chart.js"></script>
    
    <script>
        document.addEventListener("DOMContentLoaded", () => {

        // ==============================
        // ELEMENT
        // ==============================
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("overlay");
        const toggleBtn = document.getElementById("mobile-toggle");
        const collapseBtn = document.getElementById("collapseBtn");
        const content = document.querySelector(".content");
        const links = document.querySelectorAll("[data-page]");

        // fungsi load halaman
        function loadPage(page) {
        fetch(`pages/${page}.html`)
            .then(response => {
            if (!response.ok) throw new Error("Halaman tidak ditemukan");
            return response.text();
            })
            .then(data => {
            content.innerHTML = data;
            })
            .catch(error => {
            content.innerHTML = "<h2>Halaman tidak ditemukan</h2>";
            });
        }

        // event klik sidebar
        links.forEach(link => {
        link.addEventListener("click", function(e) {
            e.preventDefault();
            const page = this.getAttribute("data-page");
            loadPage(page);
        });
        });

        // load default page saat pertama kali masuk
        loadPage("beranda");
    </script>
    <script>
<<<<<<<<< Temporary merge branch 1
        const sidebarLinks = document.querySelectorAll(".sidebar-list a");

        // ==============================
        // AUTH CHECK
        // ==============================
        if (!localStorage.getItem("token") || localStorage.getItem("role") !== "dosen") {
            window.location.href = "index.html";
            return;
        }

        document.getElementById("showName").innerText = localStorage.getItem("name");
        document.getElementById("showNidn").innerText = localStorage.getItem("nidn");

        // ==============================
        // LOAD PAGE FUNCTION
        // ==============================
        function loadPage(page) {
            fetch(`/pages/${page}.html`)
                .then(response => {
                    if (!response.ok) throw new Error("404");
                    return response.text();
                })
                .then(data => {
                    content.innerHTML = data;

                    // ðŸ”¥ Render chart jika halaman beranda
                    if (page === "beranda") {
                        setTimeout(() => {
                            renderChart();
                            renderMahasiswaChart();
                        }, 50);
                    }
                })
                .catch(() => {
                    content.innerHTML = "<h2>Halaman tidak ditemukan</h2>";
                });
        }


        // ==============================
        // SIDEBAR LINK CLICK
        // ==============================
        sidebarLinks.forEach(link => {
            link.addEventListener("click", function (e) {
            e.preventDefault();

            const page = this.getAttribute("data-page");

            // Load page
            loadPage(page);

            // Set active
            sidebarLinks.forEach(item => item.classList.remove("active"));
            this.classList.add("active");

            // Tutup sidebar jika mobile
            if (window.innerWidth <= 768) {
                sidebar.classList.remove("active");
                overlay.classList.remove("active");
            }
            });
        });

        // ==============================
        // MOBILE TOGGLE
        // ==============================
        toggleBtn.addEventListener("click", () => {
            sidebar.classList.add("active");
            overlay.classList.add("active");
        });

        // ==============================
        // CLICK OUTSIDE (OVERLAY)
        // ==============================
        overlay.addEventListener("click", () => {
            sidebar.classList.remove("active");
            overlay.classList.remove("active");
        });

        // ==============================
        // COLLAPSE DESKTOP
        // ==============================
        collapseBtn.addEventListener("click", () => {
            sidebar.classList.toggle("collapsed");

            if (sidebar.classList.contains("collapsed")) {
            collapseBtn.innerHTML = `
                <span class="material-symbols-outlined">chevron_right</span>
            `;
            } else {
            collapseBtn.innerHTML = `
                <span class="material-symbols-outlined">chevron_left</span>
                <span class="text">Collapse</span>
            `;
            }
        });

        // ==============================
        // HANDLE RESIZE
        // ==============================
        window.addEventListener("resize", () => {
            if (window.innerWidth > 768) {
            overlay.classList.remove("active");
            sidebar.classList.remove("active");
            }
        });

        // ==============================
        // LOAD DEFAULT PAGE
        // ==============================
        const defaultPage = "beranda";
        loadPage(defaultPage);

        const defaultLink = document.querySelector(
            `.sidebar-list a[data-page="${defaultPage}"]`
        );

        if (defaultLink) {
            defaultLink.classList.add("active");
        }

        });
    </script>

    <script>
if(!localStorage.getItem("token") || localStorage.getItem("role") !== "dosen"){
    window.location.href = "index.html";
}

document.getElementById("showName").innerText = localStorage.getItem("name");
document.getElementById("showNidn").innerText = localStorage.getItem("nidn");
</script>
<script type="module" src="assets/js/auth.js"></script>

</body>
</html>
